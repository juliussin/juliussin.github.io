<!DOCTYPE html>
<html>
<head>
    <title>Bangkit Final Project - Garbage Classification</title>
</head>
<body>

    <input type="file" accept="image/*" onchange="loadFile(event)">
    <img id="output" hidden/>

<p>Canvas:</p>
<canvas id="myCanvas" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.
</canvas>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.5.2/dist/tf.min.js"></script>
<script>
    var loadFile = function(event) {
        var output = document.getElementById('output');
        output.src = URL.createObjectURL(event.target.files[0]);
        output.onload = function() {
            URL.revokeObjectURL(output.src) // free memory

            var c = document.getElementById("myCanvas");
            var ctx = c.getContext("2d");
            ctx.drawImage(output, 0, 0, 256, 256);
            var imgData = ctx.getImageData(0, 0, 256, 256).data;
            var input = [];
            for(var i = 0; i < imgData.length; i += 4) {
              input.push(imgData[i + 2] / 255);
            }
            predict(input);
        }
    };

    tf.loadLayersModel('model/model.json').then(function(model) {
        window.model = model;
    });

    var predict = function(input) {      
      if (window.model) {
        window.model.predict([tf.tensor(input).reshape([1, 256, 256, 3])]).array().then(function(scores){
          scores = scores[0];
          predicted = scores.indexOf(Math.max(...scores));
          $('#number').html(predicted);
          alert(predicted);
          console.log(predicted);
        });
      } else {
        // The model takes a bit to load, if we are too fast, wait
          console.log('test');
        setTimeout(function(){predict(input)}, 50);
      }
    }
</script>
</body>
</html>
